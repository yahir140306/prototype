---
import Layout from "../layouts/Layout.astro";

// Esto se encarga de mostrar el formulario.
// La submission se mandará a "/api/agregar-cuarto" (API route).
---

<Layout>
  <div
    class="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-blue-50 py-8 px-4 sm:px-6 lg:px-8"
  >
    <div class="max-w-2xl mx-auto">
      <!-- Header -->
      <div class="text-center mb-8">
        <div
          class="mx-auto h-12 w-12 sm:h-16 sm:w-16 bg-indigo-600 rounded-full flex items-center justify-center mb-4"
        >
          <svg
            class="h-6 w-6 sm:h-8 sm:w-8 text-white"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
          </svg>
        </div>
        <h2
          class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 mb-2"
        >
          Agregar Nuevo Cuarto
        </h2>
        <p class="text-sm sm:text-base text-gray-600">
          Completa la información para publicar tu cuarto
        </p>
      </div>

      <!-- Form Card -->
      <div
        class="bg-white rounded-xl sm:rounded-2xl shadow-xl border border-gray-100 p-6 sm:p-8"
      >
        <form
          action="/api/agregar-cuarto"
          method="POST"
          enctype="multipart/form-data"
          id="room-form"
          class="space-y-6"
        >
          <!-- Basic Information Section -->
          <div class="space-y-6">
            <div class="border-b border-gray-200 pb-4">
              <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                <svg
                  class="h-5 w-5 text-indigo-600 mr-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                  ></path>
                </svg>
                Información Básica
              </h3>
            </div>

            <!-- Name Field -->
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700" for="name">
                Nombre del cuarto *
              </label>
              <div class="relative">
                <input
                  id="name"
                  name="titulo"
                  type="text"
                  required
                  placeholder="Ej: Cuarto luminoso cerca del centro"
                  class="w-full px-3 py-3 sm:py-4 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 text-sm sm:text-base placeholder-gray-400"
                />
                <div
                  class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                >
                  <svg
                    class="h-5 w-5 text-gray-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
                    ></path>
                  </svg>
                </div>
              </div>
              <div id="name-error" class="text-red-500 text-xs hidden">
                El nombre es requerido
              </div>
            </div>

            <!-- Description Field -->
            <div class="space-y-2">
              <label
                class="block text-sm font-medium text-gray-700"
                for="descripcion"
              >
                Descripción *
              </label>
              <div class="relative">
                <textarea
                  id="descripcion"
                  name="descripcion"
                  required
                  rows="4"
                  placeholder="Describe las características, amenidades, ubicación y cualquier detalle relevante del cuarto..."
                  class="w-full px-3 py-3 sm:py-4 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 text-sm sm:text-base placeholder-gray-400 resize-vertical"
                ></textarea>
                <div
                  class="absolute top-3 left-0 pl-3 flex items-start pointer-events-none"
                >
                  <svg
                    class="h-5 w-5 text-gray-400 mt-1"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M4 6h16M4 12h16M4 18h7"></path>
                  </svg>
                </div>
              </div>
              <div class="flex justify-between items-center">
                <div id="descripcion-error" class="text-red-500 text-xs hidden">
                  La descripción es requerida
                </div>
                <div id="char-count" class="text-xs text-gray-500">
                  0 / 500 caracteres
                </div>
              </div>
            </div>

            <!-- Campo de Número de Celular -->
            <div class="form-group space-y-2">
              <label
                for="celular"
                class="block text-sm font-medium text-gray-700"
                >Número de Celular (WhatsApp)*</label
              >
              <input
                type="tel"
                id="celular"
                name="celular"
                placeholder="Ej: +52 55 1234 5678"
                required
                pattern="[\+]?[0-9\s\-\(\)]+"
                title="Ingresa un número de teléfono válido"
                class="w-full px-3 py-3 sm:py-4 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 text-sm sm:text-base placeholder-gray-400"
              />
              <small class="text-gray-500 text-xs"
                >Este número se usará para contacto por WhatsApp</small
              >
            </div>

            <!-- Campo de Características -->
            <div class="form-group space-y-2">
              <label
                for="caracteristicas"
                class="block text-sm font-medium text-gray-700"
                >Características del Cuarto*</label
              >
              <textarea
                id="caracteristicas"
                name="caracteristicas"
                rows="4"
                placeholder="Describe las características del cuarto: tamaño, servicios incluidos, mobiliario, etc."
                required
                minlength="20"
                class="w-full px-3 py-3 sm:py-4 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 text-sm sm:text-base placeholder-gray-400 resize-vertical"
              ></textarea>
            </div>

            <!-- Campo de Ubicación -->
            <div class="form-group space-y-2">
              <label
                for="ubicacion"
                class="block text-sm font-medium text-gray-700"
                >Ubicación Específica*</label
              >
              <textarea
                id="ubicacion"
                name="ubicacion"
                rows="3"
                placeholder="Describe la ubicación: colonia, referencias cercanas, accesos, etc."
                required
                minlength="10"
                class="w-full px-3 py-3 sm:py-4 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 text-sm sm:text-base placeholder-gray-400 resize-vertical"
              ></textarea>
            </div>

            <!-- Price Field -->
            <div class="space-y-2">
              <label
                class="block text-sm font-medium text-gray-700"
                for="precio"
              >
                Precio mensual *
              </label>
              <div class="relative">
                <input
                  id="precio"
                  name="precio"
                  type="number"
                  required
                  min="0"
                  step="0.01"
                  placeholder="5000.00"
                  class="w-full px-3 py-3 sm:py-4 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 text-sm sm:text-base placeholder-gray-400"
                />
                <div
                  class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                >
                  <span class="text-gray-500 font-medium">$</span>
                </div>
              </div>
              <div id="precio-error" class="text-red-500 text-xs hidden">
                El precio es requerido y debe ser mayor a 0
              </div>
            </div>
          </div>

          <!-- Images Section -->
          <div class="space-y-6">
            <div class="border-b border-gray-200 pb-4">
              <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                <svg
                  class="h-5 w-5 text-indigo-600 mr-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                  ></path>
                </svg>
                Imágenes del Cuarto
              </h3>
              <p class="text-sm text-gray-600 mt-1">
                Sube hasta 3 imágenes. La primera será la imagen principal.
              </p>
            </div>

            <!-- Image Upload Fields -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              <!-- Image 1 (Required) -->
              <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">
                  Imagen principal *
                </label>
                <div class="relative">
                  <input
                    id="imagen_1"
                    name="imagen_1"
                    type="file"
                    accept="image/*"
                    required
                    class="hidden"
                  />
                  <div
                    id="upload-area-1"
                    class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-indigo-400 transition-colors cursor-pointer bg-gray-50 hover:bg-gray-100"
                  >
                    <svg
                      class="mx-auto h-12 w-12 text-gray-400"
                      stroke="currentColor"
                      fill="none"
                      viewBox="0 0 48 48"
                    >
                      <path
                        d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"></path>
                    </svg>
                    <p class="mt-2 text-sm text-gray-600">
                      <span class="font-medium text-indigo-600"
                        >Haz clic para subir</span
                      >
                      o arrastra y suelta
                    </p>
                    <p class="text-xs text-gray-500">PNG, JPG hasta 5MB</p>
                  </div>
                  <div id="preview-1" class="hidden mt-2">
                    <img class="w-full h-32 object-cover rounded-lg" />
                    <button
                      type="button"
                      class="mt-2 text-xs text-red-600 hover:text-red-800"
                      onclick="removeImage(1)"
                    >
                      Eliminar imagen
                    </button>
                  </div>
                </div>
              </div>

              <!-- Image 2 (Optional) -->
              <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">
                  Imagen adicional
                </label>
                <div class="relative">
                  <input
                    id="imagen_2"
                    name="imagen_2"
                    type="file"
                    accept="image/*"
                    class="hidden"
                  />
                  <div
                    id="upload-area-2"
                    class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-indigo-400 transition-colors cursor-pointer bg-gray-50 hover:bg-gray-100"
                  >
                    <svg
                      class="mx-auto h-12 w-12 text-gray-400"
                      stroke="currentColor"
                      fill="none"
                      viewBox="0 0 48 48"
                    >
                      <path
                        d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"></path>
                    </svg>
                    <p class="mt-2 text-sm text-gray-600">
                      <span class="font-medium text-indigo-600"
                        >Haz clic para subir</span
                      >
                    </p>
                    <p class="text-xs text-gray-500">PNG, JPG hasta 5MB</p>
                  </div>
                  <div id="preview-2" class="hidden mt-2">
                    <img class="w-full h-32 object-cover rounded-lg" />
                    <button
                      type="button"
                      class="mt-2 text-xs text-red-600 hover:text-red-800"
                      onclick="removeImage(2)"
                    >
                      Eliminar imagen
                    </button>
                  </div>
                </div>
              </div>

              <!-- Image 3 (Optional) -->
              <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">
                  Imagen adicional
                </label>
                <div class="relative">
                  <input
                    id="imagen_3"
                    name="imagen_3"
                    type="file"
                    accept="image/*"
                    class="hidden"
                  />
                  <div
                    id="upload-area-3"
                    class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-indigo-400 transition-colors cursor-pointer bg-gray-50 hover:bg-gray-100"
                  >
                    <svg
                      class="mx-auto h-12 w-12 text-gray-400"
                      stroke="currentColor"
                      fill="none"
                      viewBox="0 0 48 48"
                    >
                      <path
                        d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"></path>
                    </svg>
                    <p class="mt-2 text-sm text-gray-600">
                      <span class="font-medium text-indigo-600"
                        >Haz clic para subir</span
                      >
                    </p>
                    <p class="text-xs text-gray-500">PNG, JPG hasta 10MB</p>
                  </div>
                  <div id="preview-3" class="hidden mt-2">
                    <img class="w-full h-32 object-cover rounded-lg" />
                    <button
                      type="button"
                      class="mt-2 text-xs text-red-600 hover:text-red-800"
                      onclick="removeImage(3)"
                    >
                      Eliminar imagen
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex flex-col sm:flex-row gap-4 pt-6">
            <button
              type="button"
              onclick="history.back()"
              class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-3 sm:py-4 px-6 rounded-lg transition-all duration-200 text-sm sm:text-base"
            >
              Cancelar
            </button>
            <button
              type="submit"
              id="submit-btn"
              class="flex-1 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium py-3 sm:py-4 px-6 rounded-lg transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98] focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 text-sm sm:text-base flex items-center justify-center"
            >
              <span id="btn-text">Agregar Cuarto</span>
              <svg
                id="loading-spinner"
                class="hidden animate-spin ml-2 h-5 w-5 text-white"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"></circle>
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
              </svg>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2">
      <!-- Toasts aparecerán aquí -->
    </div>
  </div>
</Layout>

<script src="../logic/agregar-cuarto.js"></script>
